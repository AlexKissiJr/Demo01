(function(b,n){typeof exports=="object"&&typeof module<"u"?n(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],n):(b=typeof globalThis<"u"?globalThis:b||self,n(b.CodebabyReact={},b.React))})(this,function(b,n){"use strict";const u={tansformEventName(e){return this.types[e]?this.types[e]:e},types:{ask:"na-ask.vidbaby",initialized:"na-initialized.vidbaby",playResponseData:"na-playResponseData.vidbaby",response:"na-response.vidbaby",playResponse:"na-playResponse.vidbaby",microphoneStarted:"na-microphoneStarted.vidbaby",microphoneAudio:"na-microphoneAudio.vidbaby",microphoneData:"na-microphoneData.vidbaby",microphoneStop:"na-microphoneStop.vidbaby",microphoneStopped:"na-microphoneStopped.vidbaby",playerBuilt:"na-playerBuilt.vidbaby",unPark:"na-unPark.vidbaby",segmentEnded:"na-segmentEnded.vidbaby",clientData:"na-clientData.vidbaby",extractedEntity:"na-extractedEntity.vidbaby",play:"na-play.vidbaby",pause:"na-pause.vidbaby",mute:"na-mute.vidbaby",unmute:"na-unmute.vidbaby","player:state":"na-player:state.vidbaby",preRender:"na-preRender.vidbaby",interimPlayResponse:"na-interimPlayResponse.vidbaby",interimResponse:"na-interimResponse.vidbaby",interimSegmentEnded:"na-interimSegmentEnded.vidbaby",playerLoadingAssets:"na-playerLoadingAssets.vidbaby","record-start":"na-record-start.vidbaby","record-stop":"na-record-stop.vidbaby","video-progress":"na-video-progress.vidbaby","video-converted":"na-video-converted.vidbaby","video-ready":"na-video-ready.vidbaby","video-cancel":"na-video-cancel.vidbaby",camChange:"na-camChange.vidbaby",glbLoaded:"na-glbLoaded.vidbaby"}};function f(e){const t=e.replace(/([A-Z])/g,o=>`-${o[0].toLowerCase()}`);return Object.keys(u.types).includes(t)?t:e}const m=({src:e,type:t="module",async:o=!0})=>new Promise((c,d)=>{const r=document.createElement("script");r.src=e,r.type=t,r.async=o,r.onload=()=>c(r),r.onerror=()=>d(new Error("Failed to load script. Check your internet connection.")),document.head.appendChild(r)});async function C(){if(typeof window.jQuery>"u"||typeof window.$!="function"||window.jQuery.fn.jquery===void 0||window.jQuery.fn.jquery<"3.4.1"){let e=null,t=null;typeof window.jQuery<"u"&&(e=window.jQuery,t=window.$),await m({src:"https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js",type:"text/javascript",async:!1}),window.vidbaby$=window.$,e&&(window.$=t,window.jQuery=e)}else window.vidbaby$=window.$;typeof window.$>"u"&&(window.$=window.jQuery)}function j({id:e,env:t}){const[o,c]=n.useState();return n.useLayoutEffect(()=>{const d=async()=>{const r={local:`http://localhost:8080/loader.js?id=${e}&env=local`,dev:`https://bridge3-dev.codebaby.com/loader.js?id=${e}&env=dev`,qa:`https://qa-avatar.n-avatars.com/loader.js?id=${e}&env=qa`,default:`https://portal.codebaby.com/loader.js?id=${e}`},i=(typeof t=="string"?t:"").toLowerCase().replace("localhost","local"),v=r[i]||r.default;await C(),await m({src:v}),c(()=>window.vidbaby$)};window?d():setTimeout(d,3e3)},[]),o}const w=n.createContext({on(e,t){},off(e,t){},trigger(e,t){}}),E=n.forwardRef(function({children:t,id:o,env:c,...d},r){const i=j({id:o,env:c}),v=n.useCallback((s,l)=>{i&&i(document).on(u.tansformEventName(s),l)},[i]),g=n.useCallback((s,l)=>{i&&i(document).off(u.tansformEventName(s),l)},[i]),h=n.useCallback((s,l)=>{i&&i(document).trigger(u.tansformEventName(s),l)},[i]),y=n.useMemo(()=>({on:v,off:g,trigger:h}),[v,g,h]);return n.useImperativeHandle(r,function(){return y},[y]),n.useEffect(()=>{if(!i||!d||Object.keys(d).length===0)return;const s=d,l=Object.keys(d).filter(a=>a.startsWith("on")).map(a=>a.replace("on","")).map(a=>a.charAt(0).toLowerCase()+a.slice(1));if(!(l.length<=0)){for(const a of l){console.log(a);const p=`on${a.charAt(0).toUpperCase()+a.slice(1)}`;a=="initialized"?y.on(f(a),(...S)=>{console.log("initialized event"),setTimeout(()=>s[p].apply(null,...S),1700)}):y.on(f(a),s[p])}return()=>{for(const a of l){const p=`on${a.charAt(0).toUpperCase()+a.slice(1)}`;y.off(f(a),s[p])}}}},[d,i]),n.createElement(w.Provider,{value:y},n.createElement(n.Fragment,null,t,n.createElement("div",{id:"avatarContainer",className:"codebaby-react-avatar-container"})))});function $(){const{on:e,off:t,trigger:o}=n.useContext(w);return{on:e,off:t,trigger:o}}function k(){const[e,t]=n.useState(!1);return n.useEffect(()=>{let o=null;const c=()=>{if(window&&window.vidbaby$&&window.vidbaby&&window.vidbaby.initialized)return t(!0);o=setTimeout(c,1e3)};return c(),()=>{o&&clearTimeout(o)}},[]),e}b.AvatarProvider=E,b.useCodebabyEvents=$,b.useIsInitialized=k,Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=codebaby-react.umd.js.map
