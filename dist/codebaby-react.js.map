{"version":3,"file":"codebaby-react.js","sources":["../src/utils/events.js","../src/utils/normalizeEventName.js","../src/hooks/useLoadLib.js","../src/context/avatarCtx.js","../src/components/AvatarProvider.jsx","../src/hooks/useCodebabyEvents.js","../src/hooks/useIsInitialized.js"],"sourcesContent":["const events = {\n\ttansformEventName(name) {\n\t\tif(this.types[name]) {\n\t\t\treturn this.types[name];\n\t\t} else {\n\t\t\treturn name;\n\t\t}\n\t},\n\ttypes: {\n\t\task: 'na-ask.vidbaby',\n\t\tinitialized: 'na-initialized.vidbaby',\n\t\tplayResponseData: 'na-playResponseData.vidbaby',\n\t\tresponse: 'na-response.vidbaby',\n\t\tplayResponse: 'na-playResponse.vidbaby',\n\t\tmicrophoneStarted: 'na-microphoneStarted.vidbaby',\n\t\tmicrophoneAudio: 'na-microphoneAudio.vidbaby',\n\t\tmicrophoneData: 'na-microphoneData.vidbaby',\n\t\tmicrophoneStop: 'na-microphoneStop.vidbaby',\n\t\tmicrophoneStopped: 'na-microphoneStopped.vidbaby',\n\t\tplayerBuilt: 'na-playerBuilt.vidbaby',\n\t\tunPark: 'na-unPark.vidbaby',\n\t\tsegmentEnded: 'na-segmentEnded.vidbaby',\n\t\tclientData: 'na-clientData.vidbaby',\n\t\textractedEntity: 'na-extractedEntity.vidbaby',\n\t\tplay: 'na-play.vidbaby',\n\t\tpause: 'na-pause.vidbaby',\n\t\tmute: 'na-mute.vidbaby',\n\t\tunmute: 'na-unmute.vidbaby',\n\t\t'player:state': 'na-player:state.vidbaby',\n\t\tpreRender: 'na-preRender.vidbaby',\n\t\tinterimPlayResponse: 'na-interimPlayResponse.vidbaby',\n\t\tinterimResponse: 'na-interimResponse.vidbaby',\n\t\tinterimSegmentEnded: 'na-interimSegmentEnded.vidbaby',\n\t\tplayerLoadingAssets: 'na-playerLoadingAssets.vidbaby',\n\t\t'record-start': 'na-record-start.vidbaby',\n\t\t'record-stop': 'na-record-stop.vidbaby',\n\t\t'video-progress': 'na-video-progress.vidbaby',\n\t\t'video-converted': 'na-video-converted.vidbaby',\n\t\t'video-ready': 'na-video-ready.vidbaby',\n\t\t'video-cancel': 'na-video-cancel.vidbaby',\n\t\tcamChange: 'na-camChange.vidbaby',\n\t\tglbLoaded: 'na-glbLoaded.vidbaby'\n\t}\n}\n\nexport default events;","import events from \"./events\";\n\nfunction normalizeEventName(eventName) {\n  const kebabCase = eventName.replace(/([A-Z])/g, g => `-${g[0].toLowerCase()}`);\n  return Object.keys(events.types).includes(kebabCase) ? kebabCase : eventName;\n}\n\nexport default normalizeEventName;","import { useLayoutEffect, useState } from \"react\";\n\nconst loadScript = ({ src, type = 'module', async = true }) => new Promise((resolve, reject) => {\n  const script = document.createElement(\"script\");\n  script.src = src;\n  script.type = type;\n  script.async = async;\n  script.onload = () => resolve(script);\n  script.onerror = () => reject(new Error('Failed to load script. Check your internet connection.'));\n  document.head.appendChild(script);\n});\n\nasync function jqVerHandling(){\n  if(typeof window.jQuery === 'undefined'\n    || typeof window.$ != 'function'\n    || window.jQuery.fn.jquery === undefined\n    || window.jQuery.fn.jquery < '3.4.1') {\n    let siteJq = null;\n    let site$ = null;\n    if (typeof window.jQuery != 'undefined'){\n      siteJq = window.jQuery\n      site$ = window.$\n    }\n    await loadScript({ \n      src: 'https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js',\n      type: 'text/javascript',\n      async: false\n    });\n    window.vidbaby$ = window.$;\n    if(siteJq){\n      window.$ = site$;\n      window.jQuery = siteJq;\n    }\n  } else {\n    window.vidbaby$ = window.$;\n  }\n\n  if(typeof window.$ === 'undefined') {\n    window.$ = window.jQuery;\n  }\n  return;\n}\n\nfunction useLoadCodebaby({ id, env }) {\n  const [getVB, setVB] = useState();\n  \n  useLayoutEffect(() => {\n    const verify = async () => {\n      const url = env === 'local' || env === 'localhost'\n        ? `http://localhost:8080/loader.js?env=${env}&id=${id}`\n        : `https://portal.codebaby.com/loader.js?env=${env || 'prod'}&id=${id}`;\n      \n      await jqVerHandling();\n      await loadScript({ src: url });\n      setVB(() => window.vidbaby$)\n    };\n    \n    if (window) {\n      verify()\n    } else {\n      setTimeout(verify, 3000);\n    }\n  }, []);  \n\n  return getVB;\n};\n\nexport default useLoadCodebaby;","import { createContext } from \"react\";\n\nconst avatarCtx = createContext({\n  on(event, cb) {},\n\toff(event, cb) {},\n\ttrigger(event, data){},\n});\n\nexport default avatarCtx;","import React, { \n  useCallback,\n  Fragment,\n  forwardRef,\n  useMemo,\n  useImperativeHandle,\n  useEffect\n} from \"react\";\n\nimport events from \"../utils/events\";\nimport normalizeEventName from \"../utils/normalizeEventName\";\n\nimport useLoadCodebaby from \"../hooks/useLoadLib\";\nimport avatarCtx from \"../context/avatarCtx\";\n\nconst AvatarProvider = forwardRef(function RefAvatarProvider({ children, id, env, ...onFunctions }, ref) {\n  const vidbaby$ = useLoadCodebaby({ id, env });\n\n  const onCodebaby = useCallback((event, cb) => {\n    if(vidbaby$)\n      vidbaby$(document).on(events.tansformEventName(event), cb);\n    }, [vidbaby$]);\n    const offCodebaby = useCallback((event, cb) => {\n      if(vidbaby$)\n      vidbaby$(document).off(events.tansformEventName(event), cb);\n    }, [vidbaby$]);\n    const triggerCodebaby = useCallback((event, data) => {\n      if(vidbaby$)\n        vidbaby$(document).trigger(events.tansformEventName(event), data);\n  }, [vidbaby$]);\n\n  const eventHandler = useMemo(() => ({\n    on: onCodebaby,\n    off: offCodebaby,\n    trigger: triggerCodebaby,\n  }), [onCodebaby, offCodebaby, triggerCodebaby]);\n\n  useImperativeHandle(ref, function refEvents() {\n    return eventHandler;\n  }, [eventHandler]);\n\n  useEffect(() => {\n    if(!vidbaby$ || !onFunctions || Object.keys(onFunctions).length === 0)\n      return;\n    const fns = onFunctions;\n    const eventsName = Object.keys(onFunctions)\n      .filter(i => i.startsWith(\"on\"))\n      .map(i => i.replace(\"on\", \"\"))\n      .map(i => i.charAt(0).toLowerCase() + i.slice(1));\n\n    if(eventsName.length <= 0)\n      return;\n    for(const eventName of eventsName) {\n      const key = `on${eventName.charAt(0).toUpperCase() + eventName.slice(1)}`;\n      eventHandler.on(normalizeEventName(eventName), fns[key]);\n    };\n    return () => {\n      for(const eventName of eventsName) {\n        const key = `on${eventName.charAt(0).toUpperCase() + eventName.slice(1)}`;\n        eventHandler.off(normalizeEventName(eventName), fns[key]);\n      };\n    };\n  }, [onFunctions, vidbaby$]);\n\n  return (\n    <avatarCtx.Provider value={eventHandler}>\n      <Fragment>\n        {children}\n        <div id=\"avatarContainer\" className=\"codebaby-react-avatar-container\"></div>\n      </Fragment>\n    </avatarCtx.Provider>\n  );\n});\n\n\nexport {AvatarProvider};","import { useContext } from \"react\";\nimport avatarCtx from \"../context/avatarCtx\";\n\nfunction useCodebabyEvents() {\n  const { on, off, trigger } = useContext(avatarCtx);\n\n  return { on, off, trigger };\n};\n\nexport {useCodebabyEvents};","import { useEffect, useState } from 'react';\n\nfunction useIsInitialized() {\n  const [isInitialized, setIsInitialized] = useState(false);\n\n  useEffect(() => {\n    let timeoutId = null;\n    const verify = () => {\n      if(window) {\n        if(window.vidbaby$ && window.vidbaby && window.vidbaby.initialized) {\n          return setIsInitialized(true);\n        }\n      }\n      timeoutId = setTimeout(verify, 1000);\n    };\n    verify();\n    return () => {\n      if(timeoutId)\n        clearTimeout(timeoutId);\n    };\n  }, []);\n\n  return isInitialized;\n}\n\nexport {useIsInitialized};"],"names":["React","events","name","events$1","normalizeEventName","eventName","kebabCase","g","loadScript","src","type","async","resolve","reject","script","jqVerHandling","siteJq","site$","useLoadCodebaby","id","env","getVB","setVB","useState","useLayoutEffect","verify","url","avatarCtx","createContext","event","cb","data","avatarCtx$1","AvatarProvider","forwardRef","children","onFunctions","ref","vidbaby$","onCodebaby","useCallback","offCodebaby","triggerCodebaby","eventHandler","useMemo","useImperativeHandle","useEffect","fns","eventsName","i","key","Fragment","useCodebabyEvents","on","off","trigger","useContext","useIsInitialized","isInitialized","setIsInitialized","timeoutId"],"mappings":"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"}