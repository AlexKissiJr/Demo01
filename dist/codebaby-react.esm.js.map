{"version":3,"file":"codebaby-react.esm.js","sources":["../src/hooks/useLoadLib.js","../src/context/avatarCtx.js","../src/utils/events.js","../src/components/AvatarProvider.jsx","../src/hooks/useCodebabyEvents.js"],"sourcesContent":["import { useLayoutEffect, useState } from \"react\";\n\nconst loadScript = ({ src, type = 'module', async = true }) => new Promise((resolve, reject) => {\n  const script = document.createElement(\"script\");\n  script.src = src;\n  script.type = type;\n  script.async = async;\n  script.onload = () => resolve(script);\n  script.onerror = () => reject(new Error('Failed to load script. Check your internet connection.'));\n  document.head.appendChild(script);\n});\n\nasync function jqVerHandling(){\n  if(typeof window.jQuery === 'undefined'\n    || typeof window.$ != 'function'\n    || window.jQuery.fn.jquery === undefined\n    || window.jQuery.fn.jquery < '3.4.1') {\n    let siteJq = null;\n    let site$ = null;\n    if (typeof window.jQuery != 'undefined'){\n      siteJq = window.jQuery\n      site$ = window.$\n    }\n    await loadScript({ \n      src: 'https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js',\n      type: 'text/javascript',\n      async: false\n    });\n    window.vidbaby$ = window.$;\n    if(siteJq){\n      window.$ = site$;\n      window.jQuery = siteJq;\n    }\n  } else {\n    window.vidbaby$ = window.$;\n  }\n\n  if(typeof window.$ === 'undefined') {\n    window.$ = window.jQuery;\n  }\n  return;\n}\n\nfunction useLoadCodebaby({ id, env }) {\n  const [getVB, setVB] = useState();\n  \n  useLayoutEffect(() => {\n    const verify = async () => {\n      const url = env === 'local' || env === 'localhost'\n        ? `http://localhost:8080/loader.js?env=${env}&id=${id}`\n        : `https://portal.codebaby.com/loader.js?env=${env || 'prod'}&id=${id}`;\n      \n      await jqVerHandling();\n      await loadScript({ src: url });\n      setVB(() => window.vidbaby$)\n    };\n    \n    if (window) {\n      verify()\n    } else {\n      setTimeout(verify, 3000);\n    }\n  }, []);  \n\n  return getVB;\n};\n\nexport default useLoadCodebaby;","import { createContext } from \"react\";\n\nconst avatarCtx = createContext({\n  on(event, cb) {},\n\toff(event, cb) {},\n\ttrigger(event, data){},\n});\n\nexport default avatarCtx;","const events = {\n\ttansformEventName(name) {\n\t\tif(this.types[name]) {\n\t\t\treturn this.types[name];\n\t\t} else {\n\t\t\treturn name;\n\t\t}\n\t},\n\ttypes: {\n\t\task: 'na-ask.vidbaby',\n\t\tinitialized: 'na-initialized.vidbaby',\n\t\tplayResponseData: 'na-playResponseData.vidbaby',\n\t\tresponse: 'na-response.vidbaby',\n\t\tplayResponse: 'na-playResponse.vidbaby',\n\t\tmicrophoneStarted: 'na-microphoneStarted.vidbaby',\n\t\tmicrophoneAudio: 'na-microphoneAudio.vidbaby',\n\t\tmicrophoneData: 'na-microphoneData.vidbaby',\n\t\tmicrophoneStop: 'na-microphoneStop.vidbaby',\n\t\tmicrophoneStopped: 'na-microphoneStopped.vidbaby',\n\t\tplayerBuilt: 'na-playerBuilt.vidbaby',\n\t\tunPark: 'na-unPark.vidbaby',\n\t\tsegmentEnded: 'na-segmentEnded.vidbaby',\n\t\tplayResponseData: 'na-playResponseData.vidbaby',\n\t\tmicrophoneData: 'na-microphoneData.vidbaby',\n\t\tclientData: 'na-clientData.vidbaby',\n\t\textractedEntity: 'na-extractedEntity.vidbaby',\n\t\tplay: 'na-play.vidbaby',\n\t\tpause: 'na-pause.vidbaby',\n\t\tmute: 'na-mute.vidbaby',\n\t\tunmute: 'na-unmute.vidbaby',\n\t\t'player:state': 'na-player:state.vidbaby',\n\t\tpreRender: 'na-preRender.vidbaby',\n\t\tinterimPlayResponse: 'na-interimPlayResponse.vidbaby',\n\t\tinterimResponse: 'na-interimResponse.vidbaby',\n\t\tinterimSegmentEnded: 'na-interimSegmentEnded.vidbaby',\n\t\tplayerLoadingAssets: 'na-playerLoadingAssets.vidbaby',\n\t\t'record-start': 'na-record-start.vidbaby',\n\t\t'record-stop': 'na-record-stop.vidbaby',\n\t\t'video-progress': 'na-video-progress.vidbaby',\n\t\t'video-converted': 'na-video-converted.vidbaby',\n\t\t'video-ready': 'na-video-ready.vidbaby',\n\t\t'video-cancel': 'na-video-cancel.vidbaby',\n\t\tcamChange: 'na-camChange.vidbaby',\n\t\tglbLoaded: 'na-glbLoaded.vidbaby'\n\t}\n}\n\nexport default events;","import React, { \n  useCallback,\n  Fragment,\n  forwardRef,\n  useMemo,\n  useImperativeHandle,\n  useEffect\n} from \"react\";\nimport useLoadCodebaby from \"../hooks/useLoadLib\";\nimport avatarCtx from \"../context/avatarCtx\";\nimport events from \"../utils/events\";\n\nconst AvatarProvider = forwardRef(function RefAvatarProvider({ children, id, env, ...onFunctions }, ref) {\n  const vidbaby$ = useLoadCodebaby({ id, env });\n\n  const onCodebaby = useCallback((event, cb) => {\n    if(vidbaby$)\n      vidbaby$(document).on(events.tansformEventName(event), cb);\n    }, [vidbaby$]);\n    const offCodebaby = useCallback((event, cb) => {\n      if(vidbaby$)\n      vidbaby$(document).off(events.tansformEventName(event), cb);\n    }, [vidbaby$]);\n    const triggerCodebaby = useCallback((event, data) => {\n      if(vidbaby$)\n        vidbaby$(document).trigger(events.tansformEventName(event), data);\n  }, [vidbaby$]);\n\n  const eventHandler = useMemo(() => ({\n    on: onCodebaby,\n    off: offCodebaby,\n    trigger: triggerCodebaby,\n  }), [onCodebaby, offCodebaby, triggerCodebaby]);\n\n  useImperativeHandle(ref, function refEvents() {\n    return eventHandler;\n  }, [eventHandler]);\n\n  useEffect(() => {\n    if(!vidbaby$ || !onFunctions || Object.keys(onFunctions).length === 0)\n      return;\n    const fns = onFunctions;\n    const eventsName = Object.keys(onFunctions)\n      .filter(i => i.startsWith(\"on\"))\n      .map(i => i.replace(\"on\", \"\"))\n      .map(i => i.charAt(0).toLowerCase() + i.slice(1));\n\n    if(eventsName.length <= 0)\n      return;\n    for(const eventName of eventsName) {\n      const key = `on${eventName.charAt(0).toUpperCase() + eventName.slice(1)}`;\n      eventHandler.on(eventName, fns[key]);\n    };\n    return () => {\n      for(const eventName of eventsName) {\n        const key = `on${eventName.charAt(0).toUpperCase() + eventName.slice(1)}`;\n        eventHandler.off(eventName, fns[key]);\n      };\n    };\n  }, [onFunctions, vidbaby$]);\n\n  return (\n    <avatarCtx.Provider value={eventHandler}>\n      <Fragment>\n        {children}\n        <div id=\"avatarContainer\" className=\"codebaby-react-avatar-container\"></div>\n      </Fragment>\n    </avatarCtx.Provider>\n  );\n});\n\n\nexport {AvatarProvider};","import { useContext } from \"react\";\nimport avatarCtx from \"../context/avatarCtx\";\n\nfunction useCodebabyEvents() {\n  const { on, off, trigger } = useContext(avatarCtx);\n\n  return { on, off, trigger };\n};\n\nexport {useCodebabyEvents};"],"names":["loadScript","src","type","async","resolve","reject","script","jqVerHandling","siteJq","site$","useLoadCodebaby","id","env","getVB","setVB","useState","useLayoutEffect","verify","url","avatarCtx","createContext","event","cb","data","avatarCtx$1","events","name","events$1","AvatarProvider","forwardRef","children","onFunctions","ref","vidbaby$","onCodebaby","useCallback","offCodebaby","triggerCodebaby","eventHandler","useMemo","useImperativeHandle","useEffect","fns","eventsName","i","eventName","key","React","Fragment","useCodebabyEvents","on","off","trigger","useContext"],"mappings":"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"}